\documentclass[a4j,papersize,disablejfam,slide,14pt]{jsarticle}
\usepackage{graphicx,xcolor}
\usepackage{lastpage}
\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0.0pt}
\pagestyle{fancy}
\lhead{}
\chead{}
\rhead{}
\lfoot{}
\cfoot{\thepage{}/{}\pageref{LastPage}}
\rfoot{}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage[utf8]{inputenc}
\usepackage{bm}
%%----------- documentclass から17行はコピペ．意味はわからず．-----------%
% 参考：
% 	「何かを書き留める何か　LaTeX + jsarticle + slide でスライドを作る」
% 	url: http://xaro.hatenablog.jp/entry/2013/09/26/004920
%------------------------------------------------------------------------%

\boldmath %太字

%---------------------- 参照式のみ式番号表示 ----------------------%
\usepackage{mathtools}
%------------------------------------------------------------------%

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{latexsym} %qed
\usepackage{ascmac}
\allowdisplaybreaks[1]
\newtheorem{Prop}{定理}
\newtheorem{Proof}{証明}
\def\qed{{(証明終)}} %証明終了
\def\max#1#2{\operatorname{max} \left\{ #1,\ #2 \right\}} %最大
\def\min#1#2{\operatorname{min} \left\{ #1,\ #2 \right\}} %最小
\def\sup#1#2{\operatorname*{sup}_{#1} #2 } %上限
\def\inf#1#2{\operatorname*{inf}_{#1} #2 } %下限
\def\Vector#1{\boldmath $#1$} %ベクトルを太字表示
\def\Norm#1{\left\| #1 \right\|} %ノルム
\def\Det#1{\operatorname{det} \left( #1 \right)} %行列式
\def\Diag#1{\operatorname{diag} \left( #1 \right)} %行列の対角成分
\def\Exp#1{\operatorname{E} \left[ #1 \right]} %期待値
\def\Var#1{\operatorname{V} \left[ #1 \right]} %分散
\def\Cov#1#2{\operatorname{Cov} \left[ #1,\ #2 \right]} %共分散
\def\exp#1{e^{#1}} %指数関数
\def\prob#1{\operatorname{P} \left(\left\{ #1 \right\}\right)} %確率
\def\cprob#1#2{\operatorname{P} \left(\left\{ #1 \mid #2 \right\}\right)} %条件付確率

\begin{document}

\mathtoolsset{showonlyrefs = true}
\title{\Huge ゼミ資料\\待ち行列理論と板の動きへの応用}
\author{\Large 学籍番号：201311324\\百合川尚学}
\maketitle

\tableofcontents

\section{$Introduction\quad of\quad Queueing\quad Theory$}
	興味があること
	\begin{itemize}
		\item 観測を始めて$t$時間経過した後のシステム内の客数．
    	\item システムにいる客数が初期状態から$0$になるまでの時間の分布．
    	\item システムを最良気配に見立てると，最良気配にかかる注文の数量の変化の分布
    	を考えることになる．
	\end{itemize}
	\begin{picture}(100,100)
    	%待ち行列の系内モデル図
    	\put( 80, 50){\framebox(20,20){客}}
        \put( 100, 60){\vector(1,0){40}}
        \put( 110, 30){\mbox{到着}}
        \put( 160, 30){\framebox(165,60)[t]{\Large システム}}
        \put( 160, 30){\framebox(165,60)[br]{サーバー}}
        \put( 170, 50){\framebox(20,20){客}}
        \put( 190, 50){\framebox(20,20){客}}
        \put( 210, 50){\framebox(20,20){客}}
        \put( 230, 50){\framebox(20,20){客}}
        \put( 250, 50){\framebox(20,20){客}}
        \put( 300, 60){\circle{200}}
        \put( 290, 50){\framebox(20,20){客}}
        \put( 310, 60){\vector(1,0){40}}
        \put( 335, 30){\mbox{退場}}
        \thicklines
        \put( 250, -150){\vector(0,1){130}}
        \put( 240, -15){\mbox{価格}}
        \thinlines
        \put( 60, -90){\framebox(40,20){売り指値}}
        \put( 100, -80){\vector(1,0){40}}
        \put( 170, -90){\framebox(80,20){最良売り気配数量}}
        \put( 170, -120){\framebox(40,20){売り成行}}
        \put( 210, -110){\vector(1,0){30}}
        \put( 310, -90){\framebox(40,20){買い成行}}
        \put( 310, -80){\vector(-1,0){30}}
        \put( 250, -120){\framebox(80,20){最良買い気配数量}}
        \put( 420, -120){\framebox(45,20){買い指値}}
        \put( 420, -110){\vector(-1,0){40}}
	\end{picture}

\section{$References$}
	参考文献：
    \begin{enumerate}
    	\item Suzuki, Queueing, Shokabo, 1972, pp. 20-65.
        \item Endo, Zuo, Kishimoto, 
        Modelling Intra-day Stock Price Changes In Terms of
        a Continuous Double Auction System, 
        The Japan Society for Industrial and Applied Mathematics, 
        Vol.16 , No.3, 2006, pp.305-316.
        \item Li, Hui, Endo, Kishimoto, A Quantitative Model for Intraday Stock Price
         Changes Based on Order Flows, 
         J Syst Sci Complex, 2014, 27: 208-224.
    \end{enumerate}
    上記文献$2$と$3$に従い，板は最良気配のみを考え，板が動くことは最良気配値が動くこととする．\\\\
    \begin{description}
    	\item[注文の種類]\mbox{}\\
     	上記文献$2$と$3$に従い，次の4種類のみを考える．
    	\begin{itemize}
    		\item 指値買い/売り注文　(最良買い/売り気配の数量を増加する．)
        	\item 成行買い/売り注文　(最良買い/売り気配の数量を減少する．)
    	\end{itemize}
        \mbox{}\\
        \item[確率の表記]\mbox{}\\
        	本稿では確率は全て文脈に応じた確率変数$X$に対し$\prob{E} \equiv \prob{X^{-1}(E)},\ (E \subset \mathbb{R},\ X^{-1}(E) \in \mathfrak{D}(\operatorname{P}))$で表記される．
            確率空間から厳密に定義して議論を進めるには未だ知識が不足しているが，後学のためと思って，
            教科書に載っている内容や授業で聞いた事柄，その他で得た知識を思い出しながら，$M/M/1$の理論体系を自分の頭で
            再構成して書き出しているのである．
     \end{description}

\section{$Poisson\quad Arrival$}
    \begin{screen}
    或るシステムがあり，そのシステムには或る確率分布に従った時間間隔で客が訪れ，
    或る確率分布に従った時間だけサービスを受け退場する．到着の時間間隔およびサービス時間
    は客ごとに独立であると考える．
    \end{screen}
    \begin{description}
    	\item[到着時間の分布について]\mbox{}\\
    	観測開始時刻を$T_0$，始めの客が到着する時刻を$T_1$，$2$番目の客が到着する時刻を$T_2$，
    	$\cdots$ ，として系列$\{T_n\}_{n=0}^{\infty}$を得る．各時間間隔$T_n - T_{n-1}, n=0,1,2,\cdots$
    	はどの二つも互いに独立で同一な確率分布(到着分布)に従う．
    \end{description}

\subsection{$Random\quad Arrival$}
    \begin{description}
    	\item[ランダムな到着]\mbox{}\\
        	\begin{itemize}
    			\item 観測開始時点$T_0$を$0$とする．
        		\item 時間間隔$(0, T]$の間に$A_{(0, T]}$人の到着があるとする．
        		\item 客の到着は全て独立に発生し，各々の客の到着時点の選び方は$(0, T]$上の一様分布に従うとする．
                即ち一人の客が時間$(\tau, \tau + t] \subset (0, T]$に到着する確率は$\frac{t}{T}$である．
            \end{itemize}
            \mbox{}\\
        	この下で任意に考える時間間隔$(\tau, \tau + t] \subset (0, T]$での到着数の分布は以下の式で表現される．
        	\begin{align}
        		\cprob{A_{(\tau, \tau + t]} = n}{(\tau, \tau + t] \subset (0, T]} = \frac{A_{(0, T]}!}{n!(A_{(0, T]}-n)!} \left( \frac{t}{T} \right)^n \left( \frac{T-t}{T} \right)^{A_{(0, T]}-n}.
        	\end{align}
        	この場合の到着率は$\frac{A_{(0, T]}}{T}$.
        	この到着率が$T \to \infty$で或る一定値に収まると考える：$\lim\limits_{T \to \infty} \frac{A_{(0, T]}}{T} = \lambda < \infty.$ \\
        	つまり十分大きな時間経過を考えて，$A_{(0, T]} = \lambda T + o(T)$も成立する．到着数の分布は次のように表される．
        	\begin{align}
        		\prob{A_{(\tau, \tau + t]} = n} &= \prob{(\tau, \tau + t] \subset (0, \infty]} \cprob{A_{(\tau, \tau + t]} = n}{(\tau, \tau + t] \subset (0, \infty]} \\
                &= \lim_{T \to \infty} \prob{(\tau, \tau + t] \subset (0, T]} \lim_{T \to \infty} \cprob{A_{(\tau, \tau + t]} = n}{(\tau, \tau + t] \subset (0, T]} \\
                &= \lim_{T \to \infty} \frac{A_{(0, T]}!}{n!(A_{(0, T]}-n)!} \left( \frac{t}{T} \right)^n \left( \frac{T-t}{T} \right)^{A_{(0, T]}-n} \\
            	&= \lim_{T \to \infty} \frac{t^n}{n!} \left(\frac{T-t}{T}\right)^{A_{(0, T]}} \frac{A_{(0, T]}(A_{(0, T]}-1)(A_{(0, T]}-2)\cdots(A_{(0, T]}-n+1)}{(T-t)^n} \\
            	&= \lim_{T \to \infty} \frac{t^n}{n!} \left(\left(1 - \frac{t}{T}\right)^{\frac{T}{t}}\right)^{\lambda t + o(1)t}
            		\frac{(\lambda + o(1))(\lambda + o(1)-\frac{1}{T})\cdots(\lambda + o(1)-\frac{n-1}{T})}{(1-\frac{t}{T})^n} \\
            	&= \exp{-\lambda t} \frac{(\lambda t)^n}{n!}.
        	\end{align}
            \mbox{}\\
            始めから$A_{(0, T]}$と$T$が$\frac{A_{(0, T]}}{T} = \lambda$を満たすように変化すると仮定しても結果は同じである．客の到着がランダムで均質に発生する場合，
            或る時間の到着数の分布が$Poisson$分布の形で表現される．この結果が，$Poisson$到着がランダム到着であると云われる所以である．
    \end{description}
    
\subsection{$k-Erlang\quad distribution$}
	\begin{description}
    	\item[到着分布の例：$k-$アーラン分布\ $(k-Erlang\ distribution)$]\mbox{}\\
    		分布関数を$E_k(x),\ -\infty < x < \infty$と表すと，
    		\begin{align}
    			E_k(x) \equiv
        		\begin{cases}
        			1 - \exp{-\lambda k x} \left( 1 + \frac{\lambda k x}{1!} + \cdots + \frac{(\lambda k x)^{k-1}}{(k-1)!} \right) & \text{$x \geq 0$}\\
    				0 & \text{$x < 0$}
        		\end{cases}
    		\end{align}
            平均 $\frac{1}{\lambda}$，分散 $\frac{1}{k\lambda^2}$，
            特性関数 $\phi_{E_k}(t) = \left( 1 - \frac{it}{\lambda k} \right)^{-k}$($i$:虚数単位)．(付録$1$参照)
    \end{description}
    到着分布の平均の逆数を到着率と云う．これは単位時間当たりの平均到着客数を表す．(上の例だと到着率は$\lambda$．) \\
	\begin{screen}
    	\begin{Prop}
        	$k-$アーラン分布の到着率を$\lambda$とする．ここで一定到着分布を
            \begin{align}
            	F(x) \equiv
                \begin{cases}
                	1 & \text{$x \geq \frac{1}{\lambda}$}\\
                    0 & \text{$x < \frac{1}{\lambda}$}
                \end{cases}
            \end{align}
            とおく．$k-$アーラン分布は$k \rightarrow \infty$で一定到着分布に分布収束する．
        \end{Prop}
    \end{screen}
    \begin{Proof}
    	$k-$アーラン分布の特性関数を$\phi_{E_k}(t)$，一定到着の分布の特性関数を$\phi_{F}(t)$と表す．
        $\phi_{E_k}(t)$が$\phi_{F}(t)$に各点収束すれば，$Glivenko$の定理により定理が示される．
        \begin{align}
        	\lim_{k \to \infty} \phi_{E_k}(t) = \lim_{k \to \infty} \left( 1 - \frac{it}{\lambda k} \right)^{-k} 
            = \exp{\frac{it}{\lambda}}.
        \end{align}
        一方，一定到着の特性関数は，一定到着分布が離散分布であるから，
        \begin{align}
        	\int_{-\infty}^{\infty} \exp{itx} dF(x) = \exp{it\frac{1}{\lambda}} F(\frac{1}{\lambda}) = \exp{\frac{it}{\lambda}}.
        \end{align}
        従って定理は証明された．\qed
    \end{Proof}
    \mbox{}\\
    $k = 1$の場合，$k-$アーラン分布は指数分布$E_X(\lambda)$に一致する．後述することであるが，到着時間間隔が指数分布に従うとすると，
    客は$Poisson$到着する．この定理は，時間間隔が$k-$アーラン分布に従う到着がランダム到着と一定到着の中間にあることを示唆している．

\newpage
\subsection{$Poisson\quad Arrival$}
	$k-$アーラン分布の$k = 1$のとき，客の到着時間間隔は到着率$\lambda$の指数分布$E_X(\lambda)$に従う．指数分布は無記憶性を有つ:
    \begin{align}
    	&X(\omega) \sim E_X(\lambda),\\
    	&\cprob{X \leq \tau+t}{X > \tau} = \frac{\exp{\lambda \tau} - \exp{\lambda (\tau+t)}}{\exp{\lambda \tau}} = \prob{X \leq t}. \quad (\tau,t > 0)
    \end{align}
    この性質から，次の定理が成り立つ．
    \begin{screen}
    	\begin{Prop}
    		到着時間間隔が独立に同一な指数分布に従うとき，任意の時間区間$(\tau, \tau + t]$に到着する客数は同一な$Poisson$過程に従い，
    		重ならない時間間隔では独立となる．また逆も成り立つ．
        \end{Prop}
    \end{screen}
    \begin{Proof}
    	\begin{description}
        	\begin{picture}(100,80)
            	%数直線を描く
    			\put( -20, 40){\vector(1,0){400}}
                \put( -10, 30){\line(0,1){20}}
                \put( -12, 60){{0}}
                \put( 0, 32){\vector(0,1){5}}
                \put( 14, 32){\vector(0,1){5}}
                \put( 36, 32){\vector(0,1){5}}
                \put( 42, 32){\vector(0,1){5}}
                \put( 79, 32){\vector(0,1){5}}
                \put( 120, 32){\vector(0,1){5}}
                \put( 120, 50){\mbox{{\Large $\tau$}}}
                \put( 125, 40){\line(0,1){8}}
                \put( 142, 32){\vector(0,1){5}}
                \put( 166, 32){\vector(0,1){5}}
                \put( 200, 32){\vector(0,1){5}}
                \put( 210, 32){\vector(0,1){5}}
                \put( 214, 32){\vector(0,1){5}}
                \put( 232, 32){\vector(0,1){5}}
                \put( 229, 50){\mbox{{\large $\tau$}+{\large $t$}}}
                \put( 240, 40){\line(0,1){8}}
                \put( 240, 32){\vector(0,1){5}}
                \put( 280, 32){\vector(0,1){5}}
                \put( 298, 32){\vector(0,1){5}}
                \put( 314, 32){\vector(0,1){5}}
                \put( 316, 32){\vector(0,1){5}}
                \put( 326, 32){\vector(0,1){5}}
                \put( 350, 32){\vector(0,1){5}}
			\end{picture}
    		\item[(1)任意の時間区間に到着する客数は同一な$Poisson$過程に従う]\mbox{}\\
            	
        		観測開始時点を$0$として，時間$(\tau,\tau+t]$の間にシステムに到着する客数の総数を$A_{(\tau,\tau+t]}$の分布を求める．
            	$G_n(x)\ (x \geq 0)$を，$Gamma$分布$G_A(n, \frac{1}{\lambda})$の分布関数であるとする．
	    		\begin{align}
                	\prob{A_{(\tau,\tau+t]} = n} &= \prob{A_{(\tau,\tau+t]} \geq n} - \prob{A_{(\tau,\tau+t]} \geq n+1}\\
                	&= \prob{G_n(x) \leq t} - \prob{G_{n+1}(x) \leq t} \qquad (\mbox{付録2参照})\\
                	&= \int_{0}^{t} \frac{\lambda^n}{(n-1)!}x^{n-1}\exp{-\lambda x} dx - \int_{0}^{t} \frac{\lambda^{n+1}}{n!}x^n\exp{-\lambda x} dx \\
                	&= \left[ \frac{\lambda^n}{n!}x^n\exp{-\lambda x} \right]_{x=0}^{x=t} + \int_{0}^{t} \frac{\lambda^{n+1}}{n!}x^n\exp{-\lambda x} dx - \int_{0}^{t} \frac{\lambda^{n+1}}{n!}x^n\exp{-\lambda x} dx \\
                	&= \frac{\lambda^n}{n!}t^n\exp{-\lambda t}.
    			\end{align}
                即ち，到着客数は時間間隔のみに依存する．
            \item[(2)重ならない時間間隔では独立となる]\mbox{}\\
            	任意の重ならない時間間隔$(\tau_1,\tau_1+t_1], (\tau_2,\tau_2+t_2]$に対して，到着客数をそれぞれ$n_1, n_2$と表すと，同時確率は以下のように表される:
                \begin{align}
                	&\prob{A_{(\tau_1,\tau_1+t_1]}=n_1, A_{(\tau_2,\tau_2+t_2]}=n_2} \\
                    &\quad= \prob{A_{(\tau_1,\tau_1+t_1]}=n_1}\cprob{A_{(\tau_2,\tau_2+t_2]}=n_2}{A_{(\tau_1,\tau_1+t_1]}=n_1} \\
                    &\quad= \left\{ \prob{G_n_1(t_1) \leq t_1} - \prob{G_{n_1+1}(t_1) \leq t_1} \right\} \left\{ \prob{G_n_2(t_2) \leq t_2} - \prob{G_{n_2+1}(t_2) \leq t_2} \right\} \\
                    &\quad= \prob{A_{(\tau_1,\tau_1+t_1]}=n_1} \prob{A_{(\tau_2,\tau_2+t_2]}=n_2}.
                \end{align}
            \item[(3)逆を示す]\mbox{}\\
            	任意の時間区間$(\tau, \tau + t]$に到着する客数は同一な$Poisson$過程に従い，重ならない時間間隔では独立となると仮定の下で，
                時間間隔を表す確率変数$\{T_n - T_{n-1}\}_{n=1}^{\infty}$の分布を導出する．最後に到着が観測されてから次の到着が観測されるまでの時間の分布は，
                \begin{align}
                	\prob{T_n - T_{n-1} \leq t} &= 1 - \int_{0}^{\infty} \cprob{A_{(\tau, \tau+t]} = 0}{A_{(0, \tau]} = n-1} d\prob{A_{(0, \tau]} = n-1} \\
                    &= 1 - \prob{A_{(0, t]} = 0} \int_{0}^{\infty} d\prob{A_{(0, \tau]} = n-1} \\
                    &= 1 - \exp{-\lambda t}.
                \end{align}
    	\end{description}
        \qed
    \end{Proof}
    一度にサービスを受ける人数を$1$として，サービス時間も到着時間間隔と同様に指数分布に従う下での待ち行列を$M/M/1 \quad (Kendall's\ notation)$と表記する．\\
    \[
    	\mbox{到着時間間隔の分布} / \mbox{サービス時間の分布} / \mbox{サーバー数}.
    \]

\section{$Chapman-Kolmogorov\quad Equation$}
	本稿では$M/M/1$のみを考える．\\
    \begin{description}
		\item[システム内の状態:]\mbox{}\\
        	観測時点$t$にて，系内客数が$j$であるとする．システム内の状態をこの客数$j$で評価する．\\
            客数は，サービスを待っている人とサービスを受けている人の和である．
    \end{description}
\subsection{$Markov\quad property$}
	前節で見てきたとおり，系内客数の変化は，
    \begin{itemize}
    	\item 客は或る一定の到着率を有つ指数分布に従ってやってくる．どの二人の客も互いの到着時間に影響を与えることはない．
    	\item 或る一定の平均時間を有つ指数分布に従って客は一人ずつサービスを受け，終わったら退場する．どの二人の客も互いのサービス時間に影響を与えることはない．
    \end{itemize}
    の2つの事象に因る．また客の到着時間間隔とサービス時間は独立に動く．任意に観測時刻の始点を置くとき，始点を置く直前までシステムに向かっていた途中である客，
    またはサービスを受けている最中であった客もいるかもしれないが，指数分布の無記憶性により，観測始点以降に観測する到着時間，サービス時間の分布は観測始点に影響されない．
    従って，現時点から次に起こる系内客数の変化は，現状のみに依存し過去の影響を受けない．これをマルコフ性$(Markov\ property)$と云う．

\subsection{$Chapman-Kolmogorov\quad Equation$}
    観測始点を$0$とし，時点$0$の系内客数を$i$と表す．この下で，観測時点$t \geq 0$における系内客数$Q(t)$の分布を
    \begin{align}
    	P_{ij}(t) &= \cprob{Q(t) = j}{Q(0) = i} \\
        P_{ij}(0) &= 
        \begin{cases}
        	1 & \text{$i = j$} \\
            0 & \text{$i \neq j$}
        \end{cases}
    \end{align}
    と表記する．

	ここで，到着時間間隔の分布を平均$\frac{1}{\lambda}$の指数分布$E_X(\lambda)$，サービス時間の分布を$E_X(\mu)$と設定する．
    状態推移のグラフを示す．

    \begin{picture}(500,150)(-20, -100)
        %系内客数の遷移線を描く
        \put( 10, -70){\vector(1,0){500}} %時間軸
        \put( 520, -70){\mbox{$t$}}
        \put( 10, -100){\vector(0,1){150}} %観測始点
        \put( 300, -10){\textcolor{blue}{\mbox{$Q(t)$}}}
        \put( -10,  0){\mbox{{\scriptsize $Q(0)$}}}
        \put( -0,  -70){\mbox{{\scriptsize $0$}}}
        \thicklines
        \put( 10, 10){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 20, 30){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 40, 10){\textcolor{blue}{\line(1,0){30}}} %Q(t)
        \put( 70, -10){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 80, -30){\textcolor{blue}{\line(1,0){50}}} %Q(t)
        \put( 130, -50){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 140, -30){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 150, -50){\textcolor{blue}{\line(1,0){30}}} %Q(t)
        \put( 180, -70){\textcolor{blue}{\line(1,0){50}}} %Q(t)
        \put( 230, -50){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 240, -30){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 260, -10){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 270, -30){\textcolor{blue}{\line(1,0){40}}} %Q(t)
        \put( 310, -50){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 330, -30){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 340, -10){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 350, 10){\textcolor{blue}{\line(1,0){50}}} %Q(t)
        \put( 400, 30){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 420, 10){\textcolor{blue}{\line(1,0){60}}} %Q(t)
        \thinlines
        \multiput( 20, 30)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 40, 10)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 70, -10)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 80, -30)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 130, -50)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 140, -30)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 150, -50)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 180, -70)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 230, -50)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 240, -30)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 260, -10)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 270, -30)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 310, -50)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 330, -30)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 340, -10)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 350, 10)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 400, 30)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 420, 10)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
	\end{picture}}
    
    最後に状態変化した時点から見て，平均$\frac{1}{\lambda}$時間で次に客が到着し状態が上に変化するか，平均$\frac{1}{\mu}$時間で次に客が退場し状態が下に変化する．
    また到着と退場は独立に動く．従って上グラフの時間軸に平行な線分は全て，その長さは，次の状態変化の方向によって指数分布$E_X(\lambda)$か$E_X(\mu)$に完全に従う確率変数の
    実現値である．従って，任意に観測始点をおく場合，観測開始から状態変化までの時間の分布は観測始点に影響されない．\\
    観測時点$t$から時間$h$だけ経過した後の系内状態を$j$とする．このとき，$P_{ij}(t)$の無記憶性から以下の等式が成立する．

    \begin{align}
    	P_{ij}(t+h) &= \sum_{k=0}^{\infty} \cprob{Q(t+h) = j}{Q(t) = k, Q(0) = i}\cprob{Q(t) = k}{Q(0) = i} \\
        &= \sum_{k=0}^{\infty} \cprob{Q(t+h) = j}{Q(t) = k}\cprob{Q(t) = k}{Q(0) = i} \\
        &= \sum_{k=0}^{\infty} \cprob{Q(h) = j}{Q(0) = k}\cprob{Q(t) = k}{Q(0) = i} \\
        &= \sum_{k=0}^{\infty} P_{ik}(t)P_{kj}(h).
    \end{align}
    これが $Chapman-Kolmogorov$の方程式である．
    \begin{screen}
    	\begin{description}
        	\item[$Chapman-Kolmogorov$の方程式]\mbox{}\\
            	任意の時間間隔$t,h > 0$と状態$i,j \geq 0$に対して，
                \begin{align}
            		P_{ij}(t+h) = \sum_{k=0}^{\infty} P_{ik}(t)P_{kj}(h).
                \end{align}
        \end{description}
    \end{screen}

\section{$Foward\quad Equations\quad of\quad Kolmogorov$}
	先ほど考えた経過時間$h$の間に，状態が上下に何段変化するのかを記述する．経過時間$h$の間の状態推移は以下の背反な事象に分割される．
    \begin{itemize}
    	\item $\alpha_h_1 \equiv $\{ 時間$h$の間に$n\ (=0,1,2,\cdots)$人の客のサービスが終わり，$n+1$人来る．\}
        \item $\alpha_h_2 \equiv $\{ 時間$h$の間に$n\ (=0,1,2,\cdots)$人の客の到着があり，$n+1$人のサービスが終わる．\}
        \item $\alpha_h_3 \equiv $\{ 時間$h$の間に$n\ (=0,1,2,\cdots)$人の客のサービスが終わり，$n$人来る．\}
        \item $\alpha_h_4 \equiv $\{ 時間$h$の間に$n\ (=0,1,2,\cdots)$人の客の到着があり，$n$人のサービスが終わる．\}
        \item $\alpha_h_5 \equiv $\{ 時間$h$の間に$n\ (=0,1,2,\cdots)$人の客のサービスが終わり，$n+2$人以上来る．\}
        \item $\alpha_h_6 \equiv $\{ 時間$h$の間に$n\ (=0,1,2,\cdots)$人の客の到着があり，$n+2$人以上のサービスが終わる．\}
    \end{itemize}
    先ず時間$h$の間に状態が上に一つだけ変化する事象を確率で表現する．
    \begin{align}
    	P_{i\ i+1}(h) &= \prob{\alpha_h_1} \\
        	&= \prob{\mbox{\{ 時刻$h$の間に客のサービスは終わらず，新しく系内に一人来る．\}}} \\
            &\quad+ \prob{\mbox{\{ 時間$h$の間に$n\ (=1,2,\cdots)$人の客のサービスが終わり，$n+1$人来る．\}}} \\
            &= \prob{A_{(0,h]} = 1} + \prob{\mbox{\{ 時間$h$の間に$n\ (=1,2,\cdots)$人の客のサービスが終わり，$n+1$人来る．\}}} \\
            &= \lambda h \exp{-\lambda h} + \prob{\mbox{\{ 時間$h$の間に$n\ (=1,2,\cdots)$人の客のサービスが終わり，$n+1$人来る．\}}} \\
            &= \lambda h \left( 1 - \lambda h + \frac{(\lambda h)^2}{2!} - \frac{(\lambda h)^3}{3!} + \cdots \right) \\
            &\quad+ \prob{\mbox{\{ 時間$h$の間に$n\ (=1,2,\cdots)$人の客のサービスが終わり，$n+1$人来る．\}}} \\
            &= \lambda h + o(h) + \prob{\mbox{\{ 時間$h$の間に$n\ (=1,2,\cdots)$人の客のサービスが終わり，$n+1$人来る．\}}}.
    \end{align}
    ここで，最終段第三項を考えると，
    \begin{align}
    		&\prob{\mbox{\{ 時間$h$の間に$n\ (=1,2,\cdots)$人の客のサービスが終わり，$n+1$人来る．\}}} \\
            &\qquad\leq \prob{\mbox{\{ 時間$h$の間に少なくとも$2$人以上の到着がある．\}}} \\
        	&\qquad= \exp{\lambda h} - 1 + \lambda h = o(h). 
    \end{align}
    従って，求めたい確率は次のように表現される．
    \begin{align}
        P_{i\ i+1}(h) = \lambda h + o(h).
    \end{align}
    ここで， $o(h)$ とは任意の$\epsilon > 0$ に対し或る$\delta >0$が存在して，$|h| < \delta$の下$\frac{|o(h)|}{|h|} < \epsilon$ とできるような量である．(付録$3$参照) \\
    時間$h$の間に状態が下に一つだけ変化する事象も，パラメータが違う他は上への移動の場合と変わらないので，
    \begin{align}
        P_{i\ i-1}(h) = 
        \begin{cases}
        	\mu h + o(h) & \text{$i \geq 1$}. \\
            0 & \text{$i = 0$}.
        \end{cases}
    \end{align}
    事象$\alpha_h_3,\ \alpha_h_4$の確率を考えるより先に事象$\alpha_h_5,\ \alpha_h_6$の確率を考える．事象$\alpha_h_5 + \alpha_h_6$の確率は，
    時間$h$の間の状態の変動が$2$以上となる事象の確率である．つい先ほどの式と同様にして，
    \begin{align}
    	s.t.\qquad |i - j| \geq 2 \\
    	P_{ij}(h) = \prob{\alpha_h_5 + \alpha_h_6}
    	&\leq \prob{\mbox{\{ 時間$h$の間に少なくとも$2$人以上の到着がある．\}}} \\
        &\quad+ \prob{\mbox{\{ 時間$h$の間に少なくとも$2$人以上の退場がある．\}}} \\
        &= o(h). 
    \end{align}
    最後に残ったのは，時間$h$の間に状態が元に戻る事象の確率の表現である．簡単に書くと，
    \begin{align}
    	P_{ii}(h) =
        \begin{cases} 
        	1 - (\lambda + \mu) h + o(h). & \text{$i \geq 1$} \\
            1 - \lambda h + o(h). & \text{$i = 0$}
        \end{cases}
    \end{align}

	変動の大きさの確率を$Chapman-Kolmogorov$の方程式に代入することで，$Kolmogorov$の前進方程式($Foward\quad Equations\quad of\quad Kolmogorov$)を得る．
    \begin{align}
    	P_{ij}(t+h) &= \sum_{k=0}^{\infty} P_{ik}(t)P_{kj}(h) \\
        &=
        \begin{cases}
        	P_{i\ j+1}(t) P_{j+1\ j}(h) + P_{ij}(t) P_{jj}(h) + P_{i\ j-1}(t) P_{j-1\ j}(h) + o(h) & \text{$j \geq 1$} \\
            P_{i 1}(t) P_{1 0}(h) + P_{i0}(t) P_{00}(h) + o(h) & \text{$j = 0$}
        \end{cases}
        \\&= 
        \begin{cases}
        	P_{i\ j+1}(t) \{\mu h + o(h)\} + P_{ij}(t) \{1 - (\lambda + \mu) h + o(h)\} + P_{i\ j-1}(t) \{\lambda h + o(h)\} + o(h) & \text{$j \geq 1$} \\
            P_{i 1}(t) \{\mu h + o(h)\} + P_{i0}(t) \{1 - \lambda h + o(h)\} + o(h) & \text{$j = 0$}
        \end{cases}
        \\&= 
        \begin{cases}
        	\mu P_{i\ j+1}(t) h  + P_{ij}(t) - (\lambda + \mu) P_{ij}(t) h + \lambda P_{i\ j-1}(t) h + o(h). & \text{$j \geq 1$} \\
            \mu P_{i 1}(t) h + P_{i0}(t) - \lambda P_{i0}(t) h + o(h). & \text{$j = 0$}
        \end{cases}
    \end{align}
    後は微分の定義に従うだけである．\\
    \begin{align}
    	\begin{cases}
    		\frac{P_{ij}(t+h) - P_{ij}(t)}{h} = \mu P_{i\ j+1}(t) - (\lambda + \mu) P_{ij}(t) + \lambda P_{i\ j-1}(t) + \frac{o(h)}{h}. & \text{$j \geq 1$} \\
        	\frac{P_{i0}(t+h) - P_{i0}(t)}{h} = \mu P_{i 1}(t) - \lambda P_{i0}(t) + \frac{o(h)}{h}. & \text{$j = 0$}
        \end{cases}
    \end{align}
    ランダウの記号が利いて，任意の$\epsilon > 0$に対し或る適当な$\delta > 0$が存在し，$0 < h < \delta$の下で，
    \begin{align}
    	\begin{cases}
    		\left| \frac{P_{ij}(t+h) - P_{ij}(t)}{h} - \mu P_{i\ j+1}(t) + (\lambda + \mu) P_{ij}(t) - \lambda P_{i\ j-1}(t) \right| = \left| \frac{o(h)}{h} \right| < \epsilon. & \text{$j \geq 1$} \\
        	\left| \frac{P_{i0}(t+h) - P_{i0}(t)}{h} - \mu P_{i 1}(t) + \lambda P_{i0}(t) \right| = \left| \frac{o(h)}{h} \right| < \epsilon. & \text{$j = 0$}
        \end{cases}
    \end{align}
    \begin{screen}
    	\begin{description}
        	\item[$Kolmogorov$の前進方程式]\mbox{}\\
            	\begin{align}
    				\begin{cases}
    					\frac{dP_{ij}(t)}{dt} = \mu P_{i\ j+1}(t) - (\lambda + \mu) P_{ij}(t) + \lambda P_{i\ j-1}(t). & \text{$j \geq 1$} \\
                        \frac{dP_{i0}(t)}{dt} = \mu P_{i 1}(t) - \lambda P_{i0}(t). & \text{$j = 0$} \\
        			\end{cases}
    			\end{align}
        \end{description}
    \end{screen}


\section{$Modified\quad Bessel\quad Function$}
	\begin{cases}
    	\text{観測開始時点} & \text{観測開始時点$T_0$を$0$とする．} \\
        \text{到着時間間隔} & \text{平均$\frac{1}{\lambda}$の指数分布$E_X(\lambda)$に従う．} \\
        \text{サービス終了時間間隔} & \text{平均$\frac{1}{\mu}$の指数分布$E_X(\mu)$に従う．}
    \end{cases}
    \mbox{}\\\mbox{}\\
    観測を開始して$t$時間経過後のシステム内の客数に興味がある．板の動きへの応用では
    板の移動直後の状態から観測を始めて(上下どちらかの板が消滅するまでの時間内で)$t$時間経過後の板の厚みが客数に対応する． \\
    
\subsection{$Blank\quad Time\quad of\quad Service$}
    $Poisson$到着の下，客の到着数$A_{(0, t]}$は
    \begin{align}
    	\prob{A_{(0, t]} = n} = \exp{-\lambda t} \frac{(\lambda t)^n}{n!}, \quad n = 0, 1, 2, \cdots
    \end{align}
    と表された．\\
    ところで時間$(0, t]$でのサービス終了数が同様に$P_O(\mu t)$に従うことは否定される．
    サービスは，系内客数が$0$となる空白時間が発生するかも知れないからである．\\
    サービス終了数も同様に$Poisson$分布の形式で表現可能にするため，システム内の全ての客のサービス終了直後，架空人物のサービスを開始する
    ことにする．架空人物のサービスでサービス時間の空白を埋める．架空人物のサービス中に実際に客が到着した場合，架空人物のサービス終了時点を
    実際の客のサービス終了時点とする．架空人物の登場が実際のシステム稼動に問題がないことは以下のように示される：
    \begin{align}
    	&\mbox{実際の客が時刻$\tau$に到着するとき，指数分布の無記憶性により，架空人物の残りサービス時間も同分布に従う．} \\
    	&\cprob{\mbox{架空人物のサービス時間} \leq \tau + t}{\mbox{架空人物のサービス時間} > \tau} \\
        &\quad= 1 - \exp{-\lambda t} \\
        &\quad= \prob{\mbox{到着した客のサービス時間} \leq t}.
    \end{align}

\subsection{$Modified\quad Bessel\quad Function$}
    架空サービスを考慮することで，時間$(0, t]$でのサービス終了数を$L_{(0, t]}$と表すと，これは以下のように表現される．
    \begin{align}
    	\prob{L_{(0, t]} = n} = \exp{-\mu t} \frac{(\mu t)^n}{n!}, \quad n = 0, 1, 2, \cdots.
    \end{align}
    $A_{(0, t]}$と$L_{(0, t]}$の差は，時間$(0, t]$での架空人物も含めた状態の変化量を表す．これを$C_{(0, t]}$と表し，その分布を計算する．
    架空人物を考慮すると状態変化量が非負である保証は無い．到着数とサービス終了数が独立であることに注意して，以下の計算ができる．
    \begin{align}
    	\prob{C_{(0, t]} = k} &= \prob{A_{(0, t]} - L_{(0, t]} = k} \\
        &= \sum_{n=\max{k}{0}}^{\infty} \prob{A_{(0, t]} = n}\cprob{L_{(0, t]} = n - k}{A_{(0, t]} = n} \quad (k = \cdots, -2, -1, 0, 1, 2, \cdots) \\
        &= \sum_{n=\max{k}{0}}^{\infty} \prob{A_{(0, t]} = n}\prob{L_{(0, t]} = n - k} \quad \mbox{($A_{(0, t]}$と$L_{(0, t]}$は独立.)}\\
        &= \sum_{n=\max{k}{0}}^{\infty} \exp{-\lambda t}\frac{(\lambda t)^n}{n!} \exp{-\mu t}\frac{(\mu t)^{n-k}}{(n-k)!} \\
        &= \exp{-(\lambda + \mu)t} \sum_{n=\max{k}{0}}^{\infty} \frac{t^{2n - k} \lambda^{\frac{2n-k}{2}} \mu^{\frac{2n-k}{2}} \left(\frac{\lambda}{\mu}\right)^{\frac{k}{2}}}{n!(n-k)!} \\
        &= \exp{-(\lambda + \mu)t} \left(\frac{\lambda}{\mu}\right)^{\frac{k}{2}} \sum_{n=\max{k}{0}}^{\infty} \frac{t^{2n - k} \lambda^{\frac{2n-k}{2}} \mu^{\frac{2n-k}{2}} }{n!(n-k)!} \\
        &= \exp{-(\lambda + \mu)t} \rho^{\frac{k}{2}} I_{-k}(2t\sqrt{\lambda \mu}). \quad (\rho \equiv \frac{\lambda}{\mu},\ I_{-k}(x) : \mbox{第一種変形$Bessel$関数})
    \end{align}
    \begin{screen}
    	\begin{description}
        	\item[第一種変形$Bessel$関数($Modified\ Bessel\ function\ of\ the\ first\ kind$)]\mbox{}\\
            	\begin{align}
                	I_{k}(x) &= \sum_{n=\max{-k}{0}}^{\infty} \frac{\left(\frac{x}{2} \right)^{2n+k}}{n!(n+k)!}, \\
                    I_{k}(x) &= \sum_{n=\max{-k}{0}}^{\infty} \frac{\left(\frac{x}{2} \right)^{2n+k}}{n!(n+k)!} \\
                    &= \sum_{m=\max{k}{0}}^{\infty} \frac{\left(\frac{x}{2} \right)^{2m-k}}{(m-k)!m!} \\
                    &= I_{-k}(x). \label{eq:bessel_symmetry_1}\\
                \end{align}
        \end{description}
    \end{screen}
    \mbox{}\\
    $Bessel$関数の対称性から，
    \begin{align}
    	\prob{C_{(0, t]} = k} = \rho^{k} \prob{C_{(0, t]} = -k}, \quad k=0,1,2,\cdots \label{eq:bessel_symmetry_2}
    \end{align}
    が成り立つ．

\subsection{$Finite\quad Number\quad of\quad Customers\quad in\quad the\quad System$}
	有限時間内での状態の変動量$C_{(0, t]}$が無限となる確率が$0$であることを示す．
    \begin{description}
    	\item[確率母関数($Probability\ generating\ function$)]\mbox{}\\
        	$|z| < 1$の下で，$C_{(0, t]}$の確率母関数は次のように計算される．
            \begin{align}
            	\Exp{z^{C_{(0, t]}}} &= \Exp{z^{A_{(0, t]} - L_{(0, t]}}} \\
                &= \Exp{z^{A_{(0, t]}}}\Exp{z^{-L_{(0, t]}}} \\
                &= \left(\sum_{n=0}^{\infty} \exp{-\lambda t} \frac{(\lambda t z)^n}{n!} \right)
                	\left(\sum_{n=0}^{\infty} \exp{-\mu t} \frac{(\frac{\mu t}{z})^n}{n!} \right) \\
                &= \exp{(-\lambda + \lambda z + \frac{\mu}{z} -\mu)t}.
            \end{align}
        \item[確率の和]
        	\begin{align}
            	\sum_{k=-\infty}^{\infty} \prob{C_{(0, t]} = k} &= \lim_{z \to 1} \Exp{z^{C_{(0, t]}}} \\
                &= \lim_{z \to 1} \exp{(-\lambda + \lambda z + \frac{\mu}{z} -\mu)t} \\
                &= 1. \qquad (t < \infty) \label{eq:sum_prob_change}
            \end{align}
            従って，$C_{(0, t]} = \infty$又は$C_{(0, t]} = -\infty$となる確率は$0$となる:
            \begin{align}
                \prob{C_{(0, t]} = \infty} + \prob{C_{(0, t]} = -\infty} &= 1 - \sum_{k=-\infty}^{\infty} \prob{C_{(0, t]} = k} \\
                &= 0.
            \end{align}
            確率の和の計算で，総和記号に$\infty$が入っているからと$\prob{C_{(0, t]} = \infty}$が総和に含まれていると考えてはならない．
            $\infty$は数ではない．総和は特定の数を指定して計算するものだが，$\infty$とはどの数よりも大きいという概念である．
    \end{description}

\subsection{$Fluctuation\quad of\quad Number\quad of\quad Customers\quad in\quad the\quad System$}
	興味は架空人物の発生を間引いた実際のシステムの系内客数の変化にある．\\
    前章と同じく，観測始点時刻を$T_0 = 0$とする．$t$時間後の系内客数を$Q(t)$で表し，$Q(t)$の時間変動を追跡する．\\
    \mbox{}\\
    下の図は板の動きを待ち行列に見立てた例である．待ち行列理論と板の動きは二つの時系列グラフによって繋がる．
    \begin{picture}(500,250)(0, -120)
    	%板を描く
        \thicklines
    	\put( 20, -25){\vector(0,1){90}} %価格線
        \thinlines
        \put( 4, 35){\framebox(16,5)} %ask3
        \put( -5, 25){\framebox(25,5)} %ask2
        \put( 16, 15){\framebox(4,5)} %ask1
    	\put( 20, 5){\framebox(30,5)} %bid1
        \put( 20, -5){\framebox(20,5)} %bid2
        \put( 20, -15){\framebox(19,5)} %bid3
        \linethickness{0.8pt}
        \put( 47, 25){\mbox{\scriptsize 板の移動}}
        \put( 50, 20){\vector(1,0){20}}
        \thicklines
    	\put( 100, -25){\vector(0,1){90}} %価格線
        \thinlines
        \put( 84, 35){\framebox(16,5)} %ask3
        \put( 75, 25){\framebox(25,5)} %ask2
        \put( 100, 15){\framebox(10,5)} %bid1
    	\put( 100, 5){\framebox(30,5)} %bid2
        \put( 100, -5){\framebox(20,5)} %bid3
        \put( 100, -15){\framebox(19,5)} %bid4
        
        \qbezier[11]( 100, 20)( 105, 23)( 110, 20)
        \qbezier[30]( 105, 23)(140, 40)( 180, 35)
        
        %板の厚さの遷移線を描く
        \put( 200, -10){\vector(1,0){300}} %時間軸
        \put( 505, -12){\mbox{$t$}}
        \put( 200, -10){\vector(0,1){80}} %観測始点
        \put( 177,  65){\mbox{$Q(t)$}}
        \put( 180,  30){\mbox{{\scriptsize $Q(0)$}}}
        \thicklines
        \put( 200, 30){\line(1,0){15}} %厚さの状態
        \put( 215, 25){\line(1,0){5}} %厚さの状態
        \put( 220, 20){\line(1,0){20}} %厚さの状態
        \put( 240, 15){\line(1,0){20}} %厚さの状態
        \put( 260, 20){\line(1,0){10}} %厚さの状態
        \put( 270, 15){\line(1,0){5}} %厚さの状態
        \put( 275, 10){\line(1,0){10}} %厚さの状態
        \put( 285, 5){\line(1,0){20}} %厚さの状態
        \put( 305, 0){\line(1,0){5}} %厚さの状態
        \put( 310, 5){\line(1,0){20}} %厚さの状態
        \put( 330, 0){\line(1,0){10}} %厚さの状態
        \put( 340, -5){\line(1,0){5}} %厚さの状態
        \put( 345, 60){\line(1,0){20}} %厚さの状態
        \put( 365, 65){\line(1,0){15}} %厚さの状態
        \put( 380, 60){\line(1,0){5}} %厚さの状態
        \put( 385, 55){\line(1,0){15}} %厚さの状態
        \put( 400, 50){\line(1,0){10}} %厚さの状態
        \put( 410, 10){\line(1,0){20}} %厚さの状態
        \put( 430, 5){\line(1,0){5}} %厚さの状態
        \thinlines
        \multiput( 215, 25)(0,2){3}{\line(0,1){0.01}}
        \multiput( 220, 20)(0,2){3}{\line(0,1){0.01}}
        \multiput( 240, 15)(0,2){3}{\line(0,1){0.01}}
        \multiput( 260, 20)(0,-2){3}{\line(0,1){0.01}}
        \multiput( 270, 15)(0,2){3}{\line(0,1){0.01}}
        \multiput( 275, 10)(0,2){3}{\line(0,1){0.01}}
        \multiput( 285, 5)(0,2){3}{\line(0,1){0.01}}
        \multiput( 305, 0)(0,2){3}{\line(0,1){0.01}}
        \multiput( 310, 5)(0,-2){3}{\line(0,1){0.01}}
        \multiput( 330, 0)(0,2){3}{\line(0,1){0.01}}
        \multiput( 340, -5)(0,2){3}{\line(0,1){0.01}}
        \multiput( 345, 60)(0,-2){80}{\line(0,1){0.01}}
        \multiput( 365, 65)(0,-2){3}{\line(0,1){0.01}}
        \multiput( 380, 60)(0,2){3}{\line(0,1){0.01}}
        \multiput( 385, 55)(0,2){3}{\line(0,1){0.01}}
        \multiput( 400, 50)(0,2){3}{\line(0,1){0.01}}
        \multiput( 410, 50)(0,-2){75}{\line(0,1){0.01}}
        \multiput( 430, 5)(0,2){3}{\line(0,1){0.01}}
        
        \put( 200, -100){\vector(1,0){300}} %時間軸
        \put( 505, -102){\mbox{$t$}}
        \put( 200, -100){\vector(0,1){80}} %観測始点
        \put( 170,  -25){\mbox{$Price$}}
        \thicklines
        \put( 200, -60){\line(1,0){145}} %価格
        \put( 345, -70){\line(1,0){65}} %価格
        \put( 410, -60){\line(1,0){25}} %価格
	\end{picture}}
    
    $Q(t)$の初期状態は$Q(0) \geq 0$と表せる．架空人物を考慮した時間$(0, t]$での状態変化量の確率変数$C_{(0, t]}$を用いて，
    時間の順を追って$Q(t)$の挙動を見る．ここで$Q(t)$が$0$になる時点列$\{Z_n\}_{n=1}^{\infty}$と，$0$になってから初めて
    増加する時点列$\{U_n\}_{n=1}^{\infty}$を用意する．便宜上$Z_0 = U_0 = T_0 = 0,\ C_{(0, U_0-0]} = -Q(0)$と設定する．
    \begin{align}
    	Q(t) =
        \begin{cases}
        	 Q(0) + C_{(0, t]} & \text{$t \in (0, Z_1]$} \\
             \qquad 0 & \text{$t \in (Z_1, U_1]$} \\
             C_{(0, t]} - C_{(0, U_1-0]} & \text{$t \in (U_1, Z_2]$} \\
             \qquad 0 & \text{$t \in (Z_2, U_2]$} \\
             C_{(0, t]} - C_{(0, U_2-0]} & \text{$t \in (U_2, Z_3]$} \\
             \qquad 0 & \text{$t \in (Z_3, U_3]$} \\
             C_{(0, t]} - C_{(0, U_3-0]} & \text{$t \in (U_3, Z_4]$} \\
        	\qquad \vdots \\
            Q(t) = C_{(0, t]} - C_{(0, U_n-0]} & \text{$t \in (U_n, Z_{n+1}]$} \\
            \qquad 0 & \text{$t \in (Z_{n+1}, U_{n+1}]$} \\
       		\qquad \vdots
        \end{cases}
        =
        \begin{cases}
        	C_{(0, t]} - C_{(0, U_n-0]}. & \text{$t \in (U_n, Z_{n+1}]$} \\
            \qquad 0. & \text{$t \in (Z_{n+1}, U_{n+1}]$}
        \end{cases}
    \end{align}
    $C_{(0, U_n-0]},\ n=1,2,3,\cdots$について精しく考える．$C_{(0, t]}$は$Q(0)$から出立して$Q(t)=0$となった後も，時点$U_1$まで単調非増加な動きを続ける．
    従って$C_{(0, U_1-0]} \leq 0$は確率$1$で起こる．この間$Q(t)$は状態$0$を維持する．時点$U_1$後は$C_{(0, U_1-0]}$を基準として$C_{(0, t]}$は単調非減少な動きに転じ，
    $Q(t)$は再び動き始める．$Q(t)$の動きは$C_{(0, t]} - C(0, U_1-0]$に完全に一致する．再び$Q(t)=0$となる時点$Z_2$以降も，$C_{(0, t]}$は時点$U_2$まで単調非増加な動きを続ける．
    即ち$C_{(0, U_2-0]} \leq C_{(0, U_1-0]}$が確率$1$で起こる．帰納的に考えて，$C_{(0, U_{n+1}-0]} \leq C_{(0, U_n-0]},\ n=1,2,3,\cdots$が成立する．この議論から，
    先ほどの$Q(t)$は次の表現に直すことができる．視覚で確認するために最後に図を入れた．
    \begin{screen}
    	初期状態$Q(0)$．系内客数$Q(t)$は時間$(0, t]$での到着数とサービス終了数の差$C(0,t]$を用いて以下の表現になる:
    	\begin{align}
    		Q(t) = \max{C_{(0, t]} - \inf{\tau \in (0, t]}{ C_{(0, \tau]}}}{Q(0) + C_{(0, t]}}. 
    	\end{align}
    \end{screen}
    \begin{picture}(500,300)(-20,-250)
        %系内客数の遷移線を描く
        \put( 10, -100){\vector(1,0){500}} %時間軸
        \put( 520, -100){\mbox{$t$}}
        \put( 10, -250){\vector(0,1){300}} %観測始点
        \put( 340, -50){\textcolor{blue}{\mbox{$Q(t)$}}}
        \put( 360, -140){\mbox{$Q(0) + C_{(0, t]}$}}
        \put( -10,  -40){\mbox{{\scriptsize $Q(0)$}}}
        \put( -0,  -100){\mbox{{\scriptsize $0$}}}
        \put( 145,  -110){\mbox{{\scriptsize $Z_1$}}}
        \put( 255,  -110){\mbox{{\scriptsize $U_1$}}}
        \put( 325,  -110){\mbox{{\scriptsize $Z_2$}}}
        \put( 395,  -110){\mbox{{\scriptsize $U_2$}}}
        \thicklines
        \put( 10, -40){\line(1,0){10}} %C_{(0, t]}
        \put( 20, -20){\line(1,0){20}} %C_{(0, t]}
        \put( 40, -40){\line(1,0){30}} %C_{(0, t]}
        \put( 70, -60){\line(1,0){10}} %C_{(0, t]}
        \put( 80, -80){\line(1,0){50}} %C_{(0, t]}
        \put( 130, -60){\line(1,0){10}} %C_{(0, t]}
        \put( 140, -80){\line(1,0){10}} %C_{(0, t]}
        \put( 150, -100){\line(1,0){30}} %C_{(0, t]}
        \put( 180, -120){\line(1,0){50}} %C_{(0, t]}
        \put( 230, -140){\line(1,0){10}} %C_{(0, t]}
        \put( 240, -160){\line(1,0){20}} %C_{(0, t]}
        \put( 260, -140){\line(1,0){10}} %C_{(0, t]}
        \put( 270, -120){\line(1,0){40}} %C_{(0, t]}
        \put( 310, -140){\line(1,0){20}} %C_{(0, t]}
        \put( 330, -160){\line(1,0){10}} %C_{(0, t]}
        \put( 340, -180){\line(1,0){10}} %C_{(0, t]}
        \put( 350, -200){\line(1,0){50}} %C_{(0, t]}
        \put( 400, -180){\line(1,0){20}} %C_{(0, t]}
        \put( 420, -160){\line(1,0){60}} %C_{(0, t]}
        \put( 10, -39){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 20, -19){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 40, -39){\textcolor{blue}{\line(1,0){30}}} %Q(t)
        \put( 70, -59){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 80, -79){\textcolor{blue}{\line(1,0){50}}} %Q(t)
        \put( 130, -59){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 140, -79){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 150, -99){\textcolor{blue}{\line(1,0){30}}} %Q(t)
        \put( 180, -99){\textcolor{blue}{\line(1,0){50}}} %Q(t)
        \put( 230, -99){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 240, -99){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 260, -79){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 270, -59){\textcolor{blue}{\line(1,0){40}}} %Q(t)
        \put( 310, -79){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 330, -99){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 340, -99){\textcolor{blue}{\line(1,0){10}}} %Q(t)
        \put( 350, -99){\textcolor{blue}{\line(1,0){50}}} %Q(t)
        \put( 400, -79){\textcolor{blue}{\line(1,0){20}}} %Q(t)
        \put( 420, -59){\textcolor{blue}{\line(1,0){60}}} %Q(t)
        \thinlines
        \multiput( 20, -20)(0,-2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 40, -40)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 70, -60)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 80, -80)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 130, -60)(0,-2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 140, -80)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 150, -100)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 180, -120)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 230, -140)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 240, -160)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 260, -140)(0,-2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 260, -140)(0,2){15}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 270, -120)(0,-2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 310, -140)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 330, -160)(0,2){25}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 340, -180)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 350, -200)(0,2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 400, -180)(0,-2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 400, -180)(0,2){35}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 420, -160)(0,-2){10}{\line(0,1){0.01}} %C_{(0, t]}
        \multiput( 19, -19)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 39, -39)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 69, -59)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 79, -79)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 129, -59)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 139, -79)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 149, -99)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 259, -79)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 269, -59)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 309, -79)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 329, -99)(0,2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 399, -79)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
        \multiput( 419, -59)(0,-2){10}{\textcolor{blue}{\line(0,1){0.01}}} %Q(t)
	\end{picture}}

\section{$Transient\quad Probability$}
	前章では架空人物を入れたシステム内の状態推移と実際の系内客数の状態推移の関係を見た．
	この章では時間$(0,t]$において実際の系内客数の状態推移の確率を計算する．

\subsection{$Transient\quad Probability$}
    $Q(0)=i$とする．$t$時間後に系内客数が$Q(t)=j$となっている確率は，$Chapman-Kolmogorov$方程式の章での表記に倣って
    $P_{ij}(t) = \cprob{Q(t)=j}{Q(0)=i}$と表される．$Q(t)$が状態$i$から$j$に推移する間に，$C_{(0, t]}$が上昇する回数と下降する回数をそれぞれ
    $u,d$と表す．当然，次の関係が成り立つ:
    \begin{align}
    	u &= A_{(0, t]}, \\
        d &= L_{(0, t]}, \\
    	j &= \max{i + u - d}{C_{(0, t]} - \inf{\tau \in (0, t]}{C_{(0, \tau]}}}. 
    \end{align}
    $Poisson$分布に従う到着と退場の下で，一度に到着するまたは退場する客数が二人以上となる確率は$0$である．($Kolmogorov$の前進方程式の章参照)
    従って$Q(t)$が一度に$2$ステップ以上移動することはない．これにより$Q(t)$が状態$i$から状態$j$に行き着くまでのステップ数が$u+d$で表される．
    $C_{(0, t]}$の変化時間間隔を無視してステップ数だけに注目すると，$u$回の上昇と$d$回の下降を経て状態$j$に行き着くまでの経路の数は
    \begin{align}
    	\frac{(u+d)!}{u!d!}
    \end{align}
    通りある．\\
    表記を簡単に，$\alpha_t \equiv A_{(0, t]},\ \beta_t \equiv A_{(0, t]},\ \gamma_t \equiv \inf{\tau \in (0, t]}{C_{(0, \tau]}}$とする．\\
    $Q(t)$とは違い，$C_{(0, t]}$は状態$0$から推移を始めて状態$u - d$に辿り着く．即ち$\gamma_t$は$0$以下且つ$u-d$以下となる:
    \begin{align}
    	\gamma_t \leq \min{0}{u - d}.
    \end{align}
    $\gamma_t$の分布を導く．任意の$m > \min{0}{u - d}$については$\cprob{\gamma_t \leq m}{\alpha_t = u,\ \beta_t = d} = 1$であるから，考えるべきは
    $m \leq \min{0}{u - d}$の場合でよい．ここで，事象$\{ \gamma_t \leq m \mid \alpha_t = u,\ \beta_t = d \}$は客の到着/サービス終了"時間"には関係せず，到着/サービス終了"数"にのみ関係する
    事に注意する．即ち，$\{ \gamma_t \leq m \mid \alpha_t = u,\ \beta_t = d \}$とは，状態変動の時点列が与えられた下で考えられる$\frac{(u+d)!}{u!d!}$通りの上下変動の中，
    $C_{(0, t]}$が状態$m$を取る経路が選ばれる事象のことである．
    
    \begin{picture}(500, 150)(-20, 0)
    	\put(  0, 45){\vector(1,0){480}}
        \put(  0,  -10){\vector(0,1){130}}
        \multiput(  0, 23.5)(2,0){150}{\line(1,0){0.7}}}
        \put(  5,  80){$C_{(0, t]}$}
        \put(-10,  45){$0$}
        \put(490,  45){$t$}
        \put(300,  25){$C_{(0, t]} = m$}
        \put(450, 35){\circle*{3}}
        \put(450, 33){$(u+d, u-d)$}

        \thicklines
        \put(  0, 46){\textcolor{violet}{\line(1,0){40}}}
        \multiput( 40, 46)(0,2){5}{\textcolor{violet}{\line(0,1){0.01}}}
        \put( 40, 56){\textcolor{violet}{\line(1,0){30}}}
        \multiput( 70, 56)(0,2){5}{\textcolor{violet}{\line(0,1){0.01}}}
        \put( 70, 66){\textcolor{violet}{\line(1,0){80}}}
        \multiput(150, 66)(0,-2){5}{\textcolor{violet}{\line(0,1){0.01}}}
        \put(150, 56){\textcolor{violet}{\line(1,0){20}}}
        \multiput(170, 56)(0,2){5}{\textcolor{violet}{\line(0,1){0.01}}}
        \put(170, 66){\textcolor{violet}{\line(1,0){50}}}
        \multiput(220, 66)(0,2){5}{\textcolor{violet}{\line(0,1){0.01}}}
        \put(220, 76){\textcolor{violet}{\vector(1,0){30}}}
        
        \put(  0, 44){\textcolor{green}{\line(1,0){40}}}
        \multiput( 40, 44)(0,-2){5}{\textcolor{green}{\line(0,1){0.01}}}
        \put( 40, 34){\textcolor{green}{\line(1,0){30}}}
        \multiput( 70, 34)(0,-2){5}{\textcolor{green}{\line(0,1){0.01}}}
        \put( 70, 24){\textcolor{green}{\line(1,0){80}}}
        \multiput(150, 24)(0,2){5}{\textcolor{green}{\line(0,1){0.01}}}
        \put(150, 34){\textcolor{green}{\line(1,0){20}}}
        \multiput(170, 34)(0,2){5}{\textcolor{green}{\line(0,1){0.01}}}
        \put(170, 44){\textcolor{green}{\line(1,0){50}}}
        \multiput(220, 44)(0,2){5}{\textcolor{green}{\line(0,1){0.01}}}
        \put(220, 54){\textcolor{green}{\vector(1,0){30}}}
        
        \put(  0, 43){\textcolor{orange}{\line(1,0){40}}}
        \multiput( 40, 43)(0,-2){5}{\textcolor{orange}{\line(0,1){0.01}}}
        \put( 40, 33){\textcolor{orange}{\line(1,0){30}}}
        \multiput( 70, 33)(0,-2){5}{\textcolor{orange}{\line(0,1){0.01}}}
        \put( 70, 23){\textcolor{orange}{\line(1,0){80}}}
        \multiput(150, 23)(0,-2){5}{\textcolor{orange}{\line(0,1){0.01}}}
        \put(150, 13){\textcolor{orange}{\line(1,0){20}}}
        \multiput(170, 13)(0,-2){5}{\textcolor{orange}{\line(0,1){0.01}}}
        \put(170,  3){\textcolor{orange}{\line(1,0){50}}}
        \multiput(220, 3)(0,2){5}{\textcolor{orange}{\line(0,1){0.01}}}
        \put(220, 13){\textcolor{orange}{\vector(1,0){30}}}
        
        \put(450, 55){\textcolor{violet}{\vector(0,-1){18}}}
        \put(430, 35){\textcolor{green}{\vector(1,0){18}}}
        \put(450, 15){\textcolor{orange}{\vector(0,1){18}}}
    \end{picture}
    
    状態$m$を通過する経路数は
    \begin{align}
    	\frac{(u+d)!}{(u-m)!(d+m)!}
    \end{align}
    であるから，$\{ \gamma_t \leq m \mid \alpha_t = u,\ \beta_t = d \}$の確率は
    \begin{align}
    	\cprob{\gamma_t \leq m}{\alpha_t = u,\ \beta_t = d} =
        \begin{cases}
        	\frac{\frac{(u+d)!}{(u-m)!(d+m)!}}{\frac{(u+d)!}{u!d!}} = \frac{u!d!}{(u-m)!(d+m)!}. & \text{$m \leq \min{0}{u - d}$} \\
            \qquad 1. & \text{$m > \min{0}{u - d}$} 
        \end{cases}
    \end{align}
    これを用いて状態変異の確率$P_{ij}(t) = \cprob{Q(t)=j}{Q(0)=i}$を表現する．ただしこれを直接計算するのではなく，先ずは
    事象$\{Q(t) \leq j \mid Q(0)=i, \alpha_t = u, \beta_t = d\}$と事象$\{\alpha_t = u, \beta_t = d \mid Q(0)=i\}$に分解して考える．\\
    $Q(t) = \max{C_{(0, t]} - \gamma_t}{Q(0) + C_{(0, t]}} = \max{u - d - \gamma_t}{i + u - d}$であることから，次の関係が出る．
    \begin{align}
    	\{Q(t) \leq j \mid Q(0)=i, \alpha_t = u, \beta_t = d\} = \{u- d - j \leq \gamma_t,\ i + u - d \leq j \}. \\
    \end{align}
    $i + u - d \leq j$は$\gamma_t$に関係なく成立するから，$\sum\limits_{<j-i>}$を$\{u,d \mid u - d \leq j - i,\ u,d \geq 0\}$を満たす$u,d$についての総和記号として，
    $\cprob{Q(t) \leq j}{Q(0)=i}$は以下のように表現される．
    \begin{align}
    	\cprob{Q(t) \leq j}{Q(0)=i} &= \sum_{<j-i>} \cprob{\alpha_t = u, \beta_t = d}{Q(0)=i} \cprob{Q(t) \leq j}{Q(0)=i, \alpha_t = u, \beta_t = d} \\
        &= \sum_{<j-i>} \prob{\alpha_t = u}\prob{\beta_t = d} \cprob{\gamma_t \geq u - d - j}{\alpha_t = u,\ \beta_t = d} \\
        &= \sum_{<j-i>} \prob{\alpha_t = u}\prob{\beta_t = d} \\
        &\quad- \sum_{<j-i>} \prob{\alpha_t = u}\prob{\beta_t = d} \cprob{\gamma_t \leq u - d - j - 1}{\alpha_t = u,\ \beta_t = d} \\
        &= \sum_{<j-i>} \exp{-\lambda t} \frac{(\lambda t)^u}{u!} \exp{-\mu t} \frac{(\mu t)^d}{d!} \\
        &\quad- \sum_{<j-i>} \exp{-\lambda t} \frac{(\lambda t)^u}{u!} \exp{-\mu t} \frac{(\mu t)^d}{d!} \frac{u!d!}{(d+j+1)!(u-j-1)!} \\
        &= \sum_{<j-i>} \exp{-\lambda t} \frac{(\lambda t)^u}{u!} \exp{-\mu t} \frac{(\mu t)^d}{d!} \\
        &\quad- \left( \frac{\lambda}{\mu} \right)^{j+1} \sum_{(u-j-1)-(d+j+1) \leq -j-i-2} \exp{-\lambda t} \frac{(\lambda t)^{u-j-1}}{(u-j-1)!} \exp{-\mu t} \frac{(\mu t)^{d+j+1}}{(d+j+1)!}.
    \end{align}
    ここで，
    \begin{align}
    	\sum_{<j-i>} \exp{-\lambda t} \frac{(\lambda t)^u}{u!} \exp{-\mu t} \frac{(\mu t)^d}{d!} = \sum_{k=-\infty}^{j-i} \prob{A_{(0, t]} - L_{(0, t]} = k}
    		= \sum_{k=-\infty}^{j-i} \prob{C_{(0, t]} = k}
    \end{align}
    が成り立つから，簡略するために
    \begin{align}
    	K_{j-i}(t) \equiv \sum\limits_{k=-\infty}^{j-i} \prob{C_{(0, t]} = k}
    \end{align}
    とおくと，$\cprob{Q(t) \leq j}{Q(0)=i}$は次のように書き換えられる．
    \begin{align}
    	\cprob{Q(t) \leq j}{Q(0)=i} = K_{j-i} - \rho^{j+1} K_{-j-i-2}(t).
    \end{align}
    
    ようやく$\cprob{Q(t) = j}{Q(0)=i}$を導出する準備が整った．最終結果は以下のようになる．
    \begin{align}
    	\cprob{Q(t) = j}{Q(0)=i} &= \cprob{Q(t) \leq j}{Q(0)=i} - \cprob{Q(t) \leq j-1}{Q(0)=i} \\
        &= K_{j-i}(t) - \rho^{j+1} K_{-j-i-2}(t) - K_{j-i-1}(t) + \rho^{j} K_{-j-i-1}(t) \\
        &= \prob{C_{(0, t]} = j-i} + \rho^j \prob{C_{(0, t]} = -j-i-1} + (1-\rho)\rho^j K_{-j-i-2}(t) \\
        &= \prob{C_{(0, t]} = j-i} + \rho^{-i-1} \prob{C_{(0, t]} = j+i+1} + (1-\rho)\rho^j K_{-j-i-2}(t).
    \end{align}
    最終段は式(\refeq{eq:bessel_symmetry_2})の関係を使った．
	\begin{screen}
    	\begin{description}
        	\item[遷移確率 ($Transient\quad probability$)]\mbox{}\\
            	実際の系内客数の状態遷移確率$\cprob{Q(t) = j}{Q(0)=i}$は，
                架空人物のサービスを考慮した状態変動量の確率変数$C_{(0, t]}$を用いて次のように表される:
                \begin{align}
            		P_{ij}(t) &= \cprob{Q(t) = j}{Q(0)=i} \\
                    &= \prob{C_{(0, t]} = j-i} + \rho^{-i-1} \prob{C_{(0, t]} = j+i+1} + (1-\rho)\rho^j K_{-j-i-2}(t), \\
                    s.t. &\quad K_{j-i}(t) = \sum_{k=-\infty}^{j-i} \prob{C_{(0, t]} = k}, \quad \rho = \frac{\lambda}{\mu}.
                \end{align}
        \end{description}
    \end{screen}

\subsection{$Transient\quad Solution$}
	有限時間内での系内客数は有限値であることを示す．初期状態を任意に$i$として，
    \begin{align}
    	\cprob{Q(t) < \infty}{Q(0)=i} &= \sum_{j = 0}^{\infty} \cprob{Q(t) = j}{Q(0)=i} \\
        &= \sum_{j = 0}^{\infty} \prob{C_{(0, t]} = j-i} + \rho^{-i-1} \sum_{j = 0}^{\infty} \prob{C_{(0, t]} = j+i+1} \\
        	&\qquad+ \sum_{j = 0}^{\infty} (1-\rho)\rho^j K_{-j-i-2}(t) \\
        &= \sum_{l = -i}^{\infty} \prob{C_{(0, t]} = l} + \rho^{-i-1} \sum_{l = i+1}^{\infty} \prob{C_{(0, t]} = l} \\
        	&\qquad+ (1-\rho) \sum_{j = 0}^{\infty} \rho^j \sum_{k = -\infty}^{-j-i-2} \prob{C_{(0, t]} = k} \\
        &= \sum_{l = -i}^{\infty} \prob{C_{(0, t]} = l} + \rho^{-i-1} \sum_{l = i+1}^{\infty} \prob{C_{(0, t]} = l} \\
        	&\qquad+ (1-\rho) \sum_{k = -\infty}^{-i-2} \prob{C_{(0, t]} = k} \sum_{j=0}^{-i-2-k} \rho^j \\
        &= \sum_{l = -i}^{\infty} \prob{C_{(0, t]} = l} + \rho^{-i-1} \sum_{l = i+1}^{\infty} \prob{C_{(0, t]} = l} \\
        	&\qquad+ (1-\rho) \sum_{k = -\infty}^{-i-2} \prob{C_{(0, t]} = k} \frac{1 - \rho^{-i-k-1}}{1 - \rho} \\
        &= \left( \sum_{k = -\infty}^{-i-2} \prob{C_{(0, t]} = k} + \sum_{l = -i}^{\infty} \prob{C_{(0, t]} = l} \right) \\
        	&\qquad+ \rho^{-i-1} \left( \sum_{l = i+1}^{\infty} \prob{C_{(0, t]} = l} - \sum_{k = -\infty}^{-i-2} \rho^{-k} \prob{C_{(0, t]} = k} \right) \\
        &= \left( \sum_{k = -\infty}^{-i-2} \prob{C_{(0, t]} = k} + \sum_{l = -i}^{\infty} \prob{C_{(0, t]} = l} \right) \\
        	&\qquad+ \rho^{-i-1} \left( \sum_{l = i+1}^{\infty} \prob{C_{(0, t]} = l} - \sum_{k = i+2}^{\infty} \prob{C_{(0, t]} = k} \right) \\
        &= 1 - \prob{C_{(0, t]} = -i-1} + \rho^{-i-1} \prob{C_{(0, t]} = i+1} \\
        &= 1 - \prob{C_{(0, t]} = -i-1} + \prob{C_{(0, t]} = -i-1} \\
        &= 1.
    \end{align}
    最後の三段の式変形は，式(\refeq{eq:bessel_symmetry_2})と(\refeq{eq:sum_prob_change})を使った．\\
    従って，次が成り立つ．
    \begin{align}
    	\cprob{Q(t) = \infty}{Q(0)=i} = 1 - \cprob{Q(t) < \infty}{Q(0)=i} = 0.
    \end{align}
    \begin{screen}
    	\begin{description}
    		\item[有限時解($Transient\quad Solution$)]\mbox{}\\
            	有限時間内では系内客数は有限である．ここから，遷移確率は別名有限時解という．
    	\end{description}
    \end{screen}

\section{$$}

\section{$Alignment\quad of\quad Arrivals$}
	問題点：
    %実データの平均到着数，平均離脱数を示す．
    %実データの時間間隔のヒストグラムを示す．
	到着の整列性はpoisson到着の下では許容か？
    ただ，サービスは複数同時に行われるべきである．指数分布の無記憶性により，
    同時到着を整列に直しても，サービス時間分布は同一の指数分布に従ってくれる．
    その際サービス時間分布に実データから計算される率を適用するとサービス時間を多く見積もりすぎることになるだろう．
    その点に注意して，サービス時間の平均を適切に計算する下でなら，$M/M/\infty$を考えてもよいのではないか?


%付録
\section{$Appendix$}
\scriptsize
\subsection{$Characteristic\quad Function\quad of\quad k-Erlang\quad Distribution$}
	\begin{description}
    	\item[到着分布の例：$k-$アーラン分布\ $(k-Erlang\ distribution)$]\mbox{}\\
    		\begin{align}
    			E_k(x) \equiv
        		\begin{cases}
        			1 - \exp{-\lambda k x} \left( 1 + \frac{\lambda k x}{1!} + \cdots + \frac{(\lambda k x)^{k-1}}{(k-1)!} \right) & \text{$x \geq 0$}\\
    				0 & \text{$x < 0$}
        		\end{cases}
    		\end{align}
        平均，分散，特性関数を計算する．
        密度関数
        \begin{align}
            f(x) &= E_k'(x) \\&= 
            \begin{cases}
        			\lambda k \exp{-\lambda k x} \left( 1 + \frac{\lambda k x}{1!} + \cdots + \frac{(\lambda k x)^{k-1}}{(k-1)!} \right)
                    - \lambda k \exp{-\lambda k x} \left( 1 + \frac{\lambda k x}{1!} + \cdots + \frac{(\lambda k x)^{k-2}}{(k-2)!} \right) & \text{$x \geq 0$}\\
    				0 & \text{$x < 0$}
        	\end{cases} 
            \\&=
            \begin{cases}
        			\lambda k \exp{-\lambda k x} \frac{(\lambda k x)^{k-1}}{(k-1)!} & \text{$x \geq 0$}\\
    				0 & \text{$x < 0$}
        	\end{cases}.
        \end{align}
        これは$Gamma$分布\ $G_A(k, \frac{1}{\lambda k})$の密度関数である．従って一般の
        $Gamma$分布\ $G_A(\alpha, \beta)$について平均，分散，特性関数を計算する方が楽である．\\
        特性関数 : 確率変数 $X \sim G_A(\alpha, \beta)$ について，
        \begin{align}
			\phi(t) &= E[e^{itX}] \\
			&= \int_{0}^{\infty} e^{itx} \frac{1}{\Gamma(\alpha)\beta^\alpha} x^{\alpha-1} e^{-\frac{x}{\beta}} dx \\
			&= \int_{0}^{\infty} \frac{1}{\Gamma(\alpha)\beta^\alpha} x^{\alpha-1} e^{-(\frac{1}{\beta}-it)x} dx	\\
			&= \lim_{R \to \infty} \int_{0}^{R} \frac{1}{\Gamma(\alpha)\beta^\alpha} x^{\alpha-1} e^{-(\frac{1}{\beta}-it)x} dx \\
			&= \lim_{R \to \infty} \frac{1}{\Gamma(\alpha)\beta^\alpha} (\frac{\beta}{1-i \beta t})^\alpha \int_{0}^{\frac{R}{\beta}-itR} z^{\alpha-1} e^{-z} dz.
		\end{align}
        ここで
		\begin{align}
			\int_{0}^{\frac{R}{\beta}-itR} z^{\alpha-1} e^{-z} dz
		\end{align}
		について複素積分を考える．
        
        \begin{picture}(300,200)(0,0)
        	\put( 30,  0){\vector(0,1){200}}
            \put(  0,180){\vector(1,0){300}}
            \thicklines
            \put(230,180){\vector(-1,0){100}}
            \put(130,180){\line(-1,0){100}}
            \put(230, 30){\vector(0,1){70}}
            \put(230,100){\line(0,1){80}}
            \put( 30,180){\vector(4,-3){200}}
            \multiput( 30, 30)(2,0){100}{\line(1,0){0.1}}
            \put( 20,170){$\mathsrc{O}$}
            \put(290,185){$\mathsrc{Re}$}
            \put( 20,200){$\mathsrc{Im}$}
            \put(100,185){$\Gamma_3$}
            \put(235,100){$\Gamma_2$}
            \put(100, 90){$\Gamma_1$}
            \put(230,185){$\frac{R}{\beta}$}
            \put(  5, 30){$-itR$}
        \end{picture}
        
        積分路を$\Gamma \equiv \Gamma_1 \cup \Gamma_2 \cup \Gamma_3$として，被積分関数が$\mathbb{C}$の整関数であることから$\Gamma$および内部領域に孤立特異点は存在しない．
		積分の向きは左回りとして，$Cauchy$の積分定理が成り立つので
		\begin{align}
			\oint_{\Gamma} z^{\alpha-1} e^{-z} dz = 0
		\end{align}
		が成り立つ．
		$\Gamma_2$上の積分は
		\begin{eqnarray}
			\left| \int_{\Gamma_2} z^{\alpha-1} e^{-z} dz \right| &= \left| \int_{-tR}^{0} (\frac{R}{\beta}+iy})^{\alpha-1} e^{-\frac{R}{\beta}-iy} i dy \right| \\
			& \leq \int_{-tR}^{0} (\frac{R}{\beta}+|y|})^{\alpha-1} e^{-\frac{R}{\beta}} dy.
		\end{eqnarray}
		任意の$\epsilon > 0$に対し$t$について定まる或る$R_1(t)$が存在して，$R > R_1(t)$ならば
		\begin{eqnarray}
			\int_{-tR}^{0} (\frac{R}{\beta}+|y|})^{\alpha-1} e^{-\frac{R}{\beta}} dy < \epsilon
		\end{eqnarray}
		が成り立つ．$\Gamma_3$上の積分は
		\begin{align}
			\int_{\frac{R}{\beta}}^{0} z^{\alpha-1} e^{-z} dz = -\int_{0}^{\frac{R}{\beta}} z^{\alpha-1} e^{-z} dz.
		\end{align}
		これも広義積分は収束するので，任意の$\epsilon > 0$に対し或る$R_2$が存在して，$R > R_2$ならば
		\begin{align}
			\Gamma(\alpha)-\epsilon < \int_{0}^{\lambda R} z^{\alpha-1} e^{-z} dx \leq \Gamma(\alpha).
		\end{align}
		従って，$R > max\{R_1(t), R_2\}$と置いて
		\begin{align}
			\left|\int_{\Gamma_1} z^{\alpha-1} e^{-z} dz -  \Gamma(\alpha)\right|
			&= \left|-\int_{\Gamma_2} z^{\alpha-1} e^{-z} dz
		    	   -\int_{\Gamma_3} z^{\alpha-1} e^{-z} dz - \Gamma(\alpha)\right| < 2 \epsilon.
		\end{align}
		$\epsilon$は任意であるから
		\begin{align}
			\lim_{R \to \infty} \frac{1}{\Gamma(\alpha)\beta^\alpha} (\frac{\beta}{1-i \beta t})^\alpha \int_{0}^{\frac{R}{\beta}-itR} z^{\alpha-1} e^{-z} dz 
			= (\frac{1}{1-i \beta t})^\alpha
		\end{align}
		が成り立つ．$t \leq 0$の場合も同じ結論となる．
        \qed
    \end{description}

\subsection{$Distribution\quad of\quad Sum\quad of\quad Exponential\quad distributed\quad Variables$}
	確率変数$X(\omega),Y(\omega)$を，それぞれ$Gamma$分布$G_A(n-1, \frac{1}{\lambda})$，指数分布$E_X(\lambda)$に独立に従うとする．
    このとき和$Z(\omega) = X(\omega) + Y(\omega)$の分布を求める．
    \begin{eqnarray}
    	\prob{Z \leq z} &=& \underset{x,y \geq 0, x + y \leq z}{\iint} \frac{\lambda^{n-1}}{(n-2)!}x^{n-2}\exp{-\lambda x} \lambda \exp{-\lambda y} dxdy \\
        &=& \int_{0}^{z} \frac{\lambda^{n-1}}{(n-2)!}x^{n-2}\exp{-\lambda x} \left[ 1 - \exp{-\lambda y} \right]_{y=0}^{y = z - x} dx \\
        &=& \int_{0}^{z} \frac{\lambda^{n-1}}{(n-2)!}x^{n-2}(\exp{-\lambda x} - \exp{-\lambda z}) dx \\
        &=& \left[ \frac{\lambda^{n-1}}{(n-1)!}x^{n-1}(\exp{-\lambda x} - \exp{-\lambda z}) \right]_{x=0}^{x=z} + \int_{0}^{z} \frac{\lambda^n}{(n-1)!}x^{n-1}\exp{-\lambda x} dx \\
        &=& \int_{0}^{z} \frac{\lambda^n}{(n-1)!}x^{n-1}\exp{-\lambda x} dx.
    \end{eqnarray}
    よって$Z$が$Gamma$分布$G_A(n, \frac{1}{\lambda})$に従っていると示された．$G_A(1, \frac{1}{\lambda}) = E_X(\lambda)$であることから，独立に同一の指数分布に従う$n$個の確率変数の
    和の分布は$G_A(n, \frac{1}{\lambda})$であることが帰納的に示される．

\subsection{$Landau\quad Symbol$}
	$Foward\quad Equations\quad of\quad Kolmogorov$の章でのランダウの記号$(Landau\ symbol)$の扱いを精しく見る．\\
	$0 < h \ll 1$として，
    \begin{eqnarray}
    	\left| \lambda h \left(- \lambda h + \frac{(\lambda h)^2}{2!} - \frac{(\lambda h)^3}{3!} + \cdots \right) \right|
        &\leq& \lambda h \left(\lambda h + \frac{(\lambda h)^2}{2!} + \frac{(\lambda h)^3}{3!} + \cdots \right) \\
        &=& \lambda h^2 \left(\lambda + \frac{\lambda^2 h}{2!} + \frac{\lambda^3 h^2}{3!} + \cdots \right) \\
        &<& \lambda h^2 \left(\lambda + \frac{\lambda^2}{2!} + \frac{\lambda^3}{3!} + \cdots \right) \\
        &=& \lambda \exp{\lambda} h^2
    \end{eqnarray}
    従って，任意の$\epsilon > 0$に対して$\delta \equiv \frac{\epsilon}{\lambda \exp{\lambda}}$ と与えればよい．\\
    $\exp{\lambda h} - 1 + \lambda h$についても同様に，
    \begin{eqnarray}
    	\exp{\lambda h} - 1 + \lambda h &=& \left(\frac{(\lambda h)^2}{2!} + \frac{(\lambda h)^3}{3!} + \cdots \right) \\
        &=& h^2 \left(\frac{\lambda^2}{2!} + \frac{\lambda^3 h}{3!} + \cdots \right) \\
        &<& h^2 \exp{\lambda}
    \end{eqnarray}
    任意の$\epsilon > 0$に対して$\delta \equiv \frac{\epsilon}{\exp{\lambda}}$ と与えればよい．

\subsection{$Properties\quad of\quad Modified\quad Bessel\quad Function\quad of\quad the\quad First\quad Kind$}
	\begin{screen}
		\begin{Prop}
    		第一種変形$Bessel$関数について以下の性質がある．
        	\begin{align}
        		(\ 1\ ) &\qquad I_0(0) = 1,\quad I_j(0) = 0,\ (j = 1,2,3,\cdots), \\
            	(\ 2\ ) &\qquad I_j(x) = I_{-j}(x),\ (j = 0,1,2,3,\cdots), \\
            	(\ 3\ ) &\qquad x\{I_{j-1}(x) - I_{j+1}(x)\} = 2jI_j(x), \\
            	(\ 4\ ) &\qquad I_j(x) < I_k(x),\ (0 \leq k < j,\ x > 0), \\
            	(\ 5\ ) &\qquad I_j(x) = \frac{\exp{x}}{\sqrt{2 \pi x}} \left\{ 1-\frac{4j^2 - 1}{8x} + o\left( \frac{1}{x^2} \right) \right\}, \\
                (\ 6\ ) &\qquad \exp{\frac{x}{2}\left(y + \frac{1}{y}\right)} = \sum_{j=-\infty}^{\infty} y^jI_j(x). 
        	\end{align}
    	\end{Prop}
    \end{screen}
    \begin{Proof}
    	\begin{description}
        	\item[]\mbox{}\\
        	\item[$(\ 1\ )$]\mbox{}\\
            	\begin{align}
                	I_0(x) &= \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n}}{n!n!} \\
                    &= 1 + x \sum_{n=1}^{\infty} \frac{\frac{1}{2}\left( \frac{x}{2} \right)^{2n-1}}{n!n!} \\
                    &\Rightarrow I_0(0) = 1. \\
                    \mbox{$j \geq 1$の場合，}&\\
                    I_j(x) &= \sum_{n=\max{-j}{0}}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j}}{n!(n+j)!} \\
                    &= \frac{x}{2} \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j-1}}{n!(n+j)!} \\
                    &\Rightarrow I_j(0) = 0.
                \end{align}
            \item[$(\ 2\ )$]\mbox{}\\
            	式(\refeq{eq:bessel_symmetry_1})による．
            \item[$(\ 3\ )$]\mbox{}\\
            	$j=0$の場合，$I_{-1}(x) - I_{1}(x)=0$\ (対称性)から，左辺は$0$，右辺はもちろん$0$である．\\
                $j \neq 0$の場合，$j-1,\ j+1$は共に非負または共に非正となり，対称性から$j \geq 1$の場合のみを考えればよい．
            	\begin{align}
                	\frac{j}{x} I_j(x) &= \frac{j}{x} \sum_{n=\max{-j}{0}}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j}}{n!(n+j)!} \\
                    &= \frac{j}{x} \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j}}{n!(n+j)!} \\
                    &= \frac{1}{2} \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j-1}}{n!(n+j-1)!} \frac{j}{n+j} \\
                    &= \frac{1}{2} \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j-1}}{n!(n+j-1)!} \left(1 - \frac{n}{n+j} \right) \\
                    &= \frac{1}{2} \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j-1}}{n!(n+j-1)!} -
                    	\frac{1}{2} \sum_{n=1}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j-1}}{(n-1)!(n+j)!} \\
                    &= \frac{1}{2} \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j-1}}{n!(n+j-1)!} -
                    	\frac{1}{2} \sum_{m=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+j+1}}{(m)!(n+j+1)!} \\
                    &= \frac{1}{2} (I_{j-1}(x) - I_{j+1}(x)).
                \end{align}
            \item[$(\ 4\ )$]\mbox{}\\
            	数学的帰納法による．$I_{k+1}(x) < I_k(x),\ (k \geq 0, x > 0)$が成り立つことを示せばよい．\\
                \begin{description}
                	\item[$x \geq 2$の場合：]\mbox{}\\
                		\begin{align}
                			I_k(x) - I_{k+1}(x) &= \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k}}{n!(n+k)!} -
                    			\sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k+1}}{n!(n+k+1)!} \\
                    		&\geq \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k}}{n!(n+k)!} -
                    			\sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k}}{n!(n+k+1)!} \quad (\because \frac{x}{2} \geq 1) \\
                            &= \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k}}{n!(n+k)!} \left( 1 - \frac{1}{n+k+1} \right) \\
                            &> 0. \quad (\because n+k+1 > 1,\ s.t.\ n > 0)
                		\end{align}
                    \item[$0 < x < 2$の場合：]\mbox{}\\
                    	\begin{align}
                    		I_k(x) - I_{k+1}(x) &= \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k}}{n!(n+k)!} -
                    			\sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k+1}}{n!(n+k+1)!} \\
                        	&= \sum_{n=0}^{\infty} \frac{\left( \frac{x}{2} \right)^{2n+k}}{n!(n+k+1)!} \left( n+k+1 - \frac{x}{2} \right) \\
                        	&> 0. \quad (\because n+k+1 > 1 > \frac{x}{2} ,\ s.t.\ n > 0)
                        \end{align}
                \end{description}
                従って，$I_{k+1}(x) < I_k(x),\ (k \geq 0, x > 0)$が示された．
            \item[$(\ 5\ )$]\mbox{}\\
            	
        \end{description}
    	\qed
    \end{Proof}
\end{document}
